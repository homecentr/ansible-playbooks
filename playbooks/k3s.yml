---
- name: "K3s cluster setup"
  hosts: k3s_nodes
  become: true
  become_method: sudo
  tasks:
    - import_role: name=../roles/k3s/cluster
      tags:
        - cluster

    - import_role: name=../roles/k3s/kadalu
      tags:
        - kadalu

    - import_role: name=../roles/k3s/cert-manager
      tags:
        - cert-manager

    - import_role: name=../roles/k3s/smtp-relay
      tags:
        - smtp-relay

    # TODO: Samba DC
    # TODO: Unifi controller

    # TODO: Netboot.xyz
    # TODO: Images samba share (both in one role)

    # TODO: DHCP configured for netboot.xyz

    # TODO: SMB Share - media
    # TODO: SMB Share - private per user data

    # TODO: NextCloud

    # TODO: Torrent client
    # TODO: SMB Share - downloads
    # TODO: Plex

    # TODO: Snipe IT (with database)

    # TODO: Organizr

    # TODO: Radius for VPN (?)

    # - import_role: name=../roles/k3s/authelia
    #   tags:
    #     - authelia
                          # TODO: Deploy redis via helm chart
                          # TODO: Deploy authelia
                          # TODO: Traefik based ingress at auth.<domain>
                          # TODO: Replace file based user database for a Samba DC
                          # TODO: Network policy - restrict who can talk to redis






  # - import_role: name=../roles/k3s/dashboard
  #   tags:
  #     - dashboard
  # TODO: Ingress through traefik at k8s.<domain>
  # TODO: Authentication
  # TODO: Switch for standard K8S dashboard
  # TODO: Pass token as header so it doesn't have be entered through UI