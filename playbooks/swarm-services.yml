---
- name: "Homecentr services running in the Docker Swarm Cluster"
  hosts: swarm_nodes
  become: true
  become_method: sudo
  tasks:
  - name: "Create local Docker macvlan network on all nodes"
    docker_network:
      name: "{{ docker_macvlan_network }}"
      driver: macvlan
      driver_options:
        parent: "{{ docker_macvlan_interface }}"
      ipam_config:
        - subnet: "{{ docker_macvlan_subnet }}"
          gateway: "{{ docker_macvlan_gateway }}"
          iprange: "{{ docker_macvlan_iprange }}"

  - name: "Swarm Local Network Connector"
    tags:
      - network-connector
    import_role:
      name: "./roles/services/network-connector"

  - name: "HTTP/HTTPS Ingress"
    tags:
      - ingress
    import_role:
      name: "./roles/services/ingress"

  # - name: "DNS"
  #   tags:
  #     - dns
  #   import_role:
  #     name: "./roles/services/dns"
  #   vars:
  #     dns_publish_network: "{{ docker_macvlan_network }}"
  #     dns_master_ipv4: "10.1.2.64"
  #     dns_slave_ipv4: "10.1.2.65"
  #     dns_master_slave_secret: "Passw0rd123456" # TODO: Move this to vault encrypted file
  #     dns_forward_zone_domain: "homecentr.io"
  #     dns_services_reverse_zone_range: "2.1.10"