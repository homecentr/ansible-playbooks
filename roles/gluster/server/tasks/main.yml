- include_tasks: ../../shared/apt.yml
- include_tasks: hosts.yml
- include_tasks: install.yml

- include_tasks: ../../shared/tls.yml
  register: gluster_tls
  vars:
    gluster_node_hostname: "{{ gluster_hostname }}" # Servers must use their gluster specific identity
    gluster_node_additional_names: 
    - "{{ gluster_fqdn }}"
    - "{{ ansible_hostname }}"
    - "{{ fqdn }}"

- include_tasks: restart.yml
  when: gluster_tls.changed

- include_tasks: exporter.yml

- include_tasks: create-volume.yml
  vars:
    gluster_volume_config: "{{ item }}"
  with_items: "{{ gluster_volumes }}"

- include_tasks: ../../shared/volume-mount.yml
  vars:
    gluster_volume: "{{ gluster_volumes | selectattr('name', 'equalto', item) | first }}"
  when: gluster_volume_mounts is defined
  with_items: "{{ gluster_volume_mounts }}"