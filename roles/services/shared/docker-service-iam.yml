---
- name: "Create group 'swarm-services'"
  group:
    name: "swarm-services"
    gid: "{{ docker_swarm_services_gid }}"
    state: present

- name: "Create group '{{ group_name }}'"
  group:
    name: "{{ group_name }}"
    gid: "{{ container_gid | mandatory }}"
    state: present

- name: "Create user '{{ user_name }}'"
  user:
    name: "{{ user_name }}"
    uid: "{{ container_uid | mandatory }}"
    group: "{{ group_name }}"
    groups:
      - "{{ group_name }}"
      - "swarm-services"
    state: present

- name: "Add '{{ admin_user }}' to the group '{{ group_name }}'"
  user:
    name: "{{ admin_user }}"
    append: true
    groups:
      - "{{ group_name }}"
  when: admin_user is defined