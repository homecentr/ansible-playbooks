version: "3.7"
services:
  # pomerium:
  #   image: ghcr.io/homecentr/traefik:{{ ingress_docker_image_version }}
  #   deploy:
  #     mode: replicated
  #     replicas: 1
  #   ports:
  #     - "8080:80/tcp"
  #   networks:
  #     - ingress
  #   environment:
  #     # PUID: "{{ ingress_user_id }}"
  #     # PGID: "{{ ingress_group_id }}"
  #   volumes:
  #     - "config:/pomerium:ro"

  verify:
    image: pomerium/verify:latest
    deploy:
      mode: replicated
      replicas: 1
      labels:
       - traefik.enable=true
       - traefik.http.routers.portainer.tls=true
       - traefik.http.routers.portainer.entrypoints=websecure
       - traefik.http.routers.portainer.rule=Host(`verify.lab.homecentr.io`)
       - traefik.http.services.portainer.loadbalancer.server.port=80
    expose:
      - "8081:80/tcp"
    networks:
      ingress:

networks:
  ingress:
    name: "homecentr-ingress"
    external: true

volumes:
  config:
    driver_opts:
      type: none
      device: "{{ auth_root_dir }}"
      o: bind