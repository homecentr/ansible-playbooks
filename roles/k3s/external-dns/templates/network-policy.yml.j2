apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: external-dns
  namespace: "{{ k3s_namespace | mandatory }}"
  labels:
    app.kubernetes.io/name: external-dns
    app.kubernetes.io/managed-by: ansible
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: external-dns
  policyTypes:
    - Ingress
  ingress:
    - ports:
      - protocol: TCP
        port: 53
      - protocol: UDP
        port: 53
      from:
{% for cidr_block in external_dns_allowed_clients_cidr_blocks %}
        - ipBlock:
            cidr: "{{ cidr_block }}"
{% endfor -%}